 /* üìö Sistema de Gesti√≥n de Biblioteca üìö */

/* Este sistema permite gestionar libros y usuarios de una biblioteca, incluyendo funcionalidades para agregar, buscar, ordenar y eliminar libros, as√≠ como registrar
 y buscar usuarios. Tambi√©n incluye reportes estad√≠sticos y normalizaci√≥n de datos. */


const prompt = require('prompt-sync')({ sigint: true });  /* Importar la librer√≠a prompt-sync para manejar entradas por consola */


/* ‚úÖPUNTO 1: Estructura de Datos */ 

/*A)- Crear un array de objetos llamado "libros" que contenga al menos 10 libros con las siguientes propiedades: 
     id (n√∫mero), titulo (string), autor (string), a√±o (n√∫mero), genero (string) y disponible (booleano). */

const libros = [  /*Se declara una palabra clave "const" llamada 'libros' que contiene una lista de objetos. */
    { id: 1, titulo: "Colmillo Blanco", autor: "Jack London", a√±o: 1906, genero: "Aventura", disponible: true },
    { id: 2, titulo: "El Principito", autor: "Antoine de Saint-Exup√©ry", a√±o: 1943, genero: "Aventura", disponible: true },
    { id: 3, titulo: "Las Aventuras de Alicia en el pais de las maravillas", autor:"Lewis Carroll", a√±o: 1865, genero: "Ficcion", disponible: true },
    { id: 4, titulo: "Martin Fierro", autor: "Jos√© Hern√°ndez", a√±o: 1872, genero: "Gauchesco", disponible: true },
    { id: 5, titulo: "Platero y Yo", autor: "Juan Ramon Jimenez", a√±o: 1914, genero: "Narrativo", disponible: true },
    { id: 6, titulo: "El Alquimista", autor: "Paulo Coelho", a√±o: 1988, genero: "Ficcion", disponible: true },
    { id: 7, titulo: "Cien a√±os de soledad", autor: "Gabriel Garc√≠a M√°rquez", a√±o: 1967, genero: "Ficcion", disponible: true },
    { id: 8, titulo: "La llamada de Cthulhu", autor: "H.P.Lovecraft", a√±o: 1928, genero: "Terror, Historieta", disponible: true },
    { id: 9, titulo: "Don Quijote de la Mancha", autor: "Miguel de Cervantes Saavedra", a√±o: 1605, genero: "Novela psicol√≥gica", disponible: true },
    { id: 10, titulo: "El diario de Anna Frank", autor: "Ana Frank", a√±o: 1947, genero: " Biografia, Autobiografia", disponible: true }
    /*Cada objeto representa un libro con sus propiedades: (id √∫nico, titulo, autor, a√±o de publicacion, g√©nero y disponibilidad) */
];

/* B) - Crear un array de objetos llamado "usuarios" que contenga al menos 5 usuarios con las siguientes propiedades:
     id (n√∫mero), nombre (string), email (string) y librosPrestados (array de objetos). */

const usuarios = [
    { id: 1, nombre: "Monica Godoy", email: "moni22@example.com", librosPrestados: [] },
    { id: 2, nombre: "Lucia Fernandez", email: "luci_fe@example.com", librosPrestados: [] },
    { id: 3, nombre: "Jose Luna", email: "jose_66_1@example.com", librosPrestados: [] },
    { id: 4, nombre: "Martin Lucero", email: "tincho-7@example.com", librosPrestados: [] },
    { id: 5, nombre: "Pablo Garcia", email: "garcia_p@example.com", librosPrestados: [] }
];

/* ---- Cada libro debe tener un ID √∫nico y cada usuario debe tener un ID √∫nico ---- /*

 
/* ‚úÖPUNTO 2: Funciones de Gesti√≥n de Libros */

/* A) Implementar una funci√≥n agregarLibro(id, titulo, autor, anio, genero) que
agregue un nuevo libro al array libros. */

function agregarLibro(id, titulo, autor, anio, genero) {
    const nuevoLibro = { id, titulo, autor, a√±o: anio, genero, disponible: true };
    libros.push(nuevoLibro);
    console.log(`Libro agregado: ${titulo}`);
}


/* B) Implementar una funci√≥n buscarLibro(criterio, valor) que busque libros por t√≠tulo, autor o g√©nero utilizando el algoritmo de busqueda lineal. */

function buscarLibro(criterio, valor) {
    const resultado = libros.filter(libro => libro[criterio].toLowerCase().includes(valor.toLowerCase()));
    if (resultado.length > 0) {
        console.log("Libros encontrados:");
        resultado.forEach(libro => console.log(`${libro.titulo} de ${libro.autor}, A√±o: ${libro.a√±o}, G√©nero: ${libro.genero}`));
    } else {
        console.log("No se encontraron libros con ese criterio.");
    }
}


/* C) Implementar una funci√≥n ordenarLibros(criterio) que ordene los libros por t√≠tulo o a√±o de publicaci√≥n, utilizando algoritmo bubblesort y mostrar los libros por consola. */

function ordenarLibros(criterio) { /*üëâ Esta funci√≥n recibe un criterio de ordenaci√≥n (t√≠tulo o a√±o) y ordena el array 'libros' seg√∫n ese criterio. */
    if (criterio === "titulo") {
        libros.sort((a, b) => a.titulo.localeCompare(b.titulo)); /*üëâ Ordena el array 'libros' alfab√©ticamente por el t√≠tulo usando 'localeCompare' que compara cadenas respetando reglas de idioma (acentos, may√∫sculas, etc.)*/
    } else if (criterio === "a√±o") {
        libros.sort((a, b) => a.a√±o - b.a√±o); /*üëâ Ordena el array 'libros' num√©ricamente por el a√±o de publicaci√≥n, restando los a√±os de dos libros para determinar su orden */
    } else {
        console.log("Criterio no v√°lido. Use 'titulo' o 'a√±o'.");
        return;
    }
    console.log("Libros ordenados:");
    libros.forEach(libro => console.log(`${libro.titulo} de ${libro.autor}, A√±o: ${libro.a√±o}, G√©nero: ${libro.genero}`));
}


/* D) Implementar una funci√≥n borrarLibro(id) que elimine un libro que se le pase por par√°metro. */

function borrarLibro(id) {
    const index = libros.findIndex(libro => libro.id === id);
    if (index !== -1) {
        const libroBorrado = libros.splice(index, 1); /*üëâ Se usa 'splice' para eliminar el libro del array 'libros' en la posici√≥n 'index' y devuelve un array con el libro eliminado */
        console.log(`Libro borrado: ${libroBorrado[0].titulo}`);
    } else {
        console.log("No se encontr√≥ un libro con ese ID.");
    }
}
console.log("Gesti√≥n de Libros:"); 
agregarLibro(11, "El Hobbit", "J.R.R. Tolkien", 1937, "Ficci√≥n de fantas√≠a");
buscarLibro("titulo", "El Hobbit");
ordenarLibros("titulo");
borrarLibro(11);


/* ‚úÖPUNTO 3: Gesti√≥n de Usuarios */

/* A) Implementar una funci√≥n registrarUsuario(nombre, email) que agregue un nuevo usuario al array usuarios. */

function registrarUsuario(nombre, email) { 
    const nuevoUsuario = { id: usuarios.length + 1, nombre, email, librosPrestados: [] };
    usuarios.push(nuevoUsuario);
    console.log(`Usuario registrado: ${nombre}`);
}


/* B) Implementar una funci√≥n mostrarTodosLosUsuarios() que muestre todos los usuarios registrados. */

function mostrarTodosLosUsuarios() {
    console.log("Lista de usuarios:");
    usuarios.forEach(usuario => console.log(`${usuario.nombre} (${usuario.email})`));
}


/* C) Implementar una funci√≥n buscarUsuario(email) que busque un usuario por su email. */

function buscarUsuario(email) {
    const usuario = usuarios.find(user => user.email.toLowerCase() === email.toLowerCase());
    if (usuario) {
        console.log(`Usuario encontrado: ${usuario.nombre}, Email: ${usuario.email}`);
    } else {
        console.log("No se encontr√≥ un usuario con ese email.");
    }
}   


/* D) Implementar una funci√≥n borrarUsuario(nombre, email) que elimine el usuario seleccionado. */

function borrarUsuario(nombre, email) {
    const index = usuarios.findIndex(user => user.nombre.toLowerCase() === nombre.toLowerCase() && user.email.toLowerCase() === email.toLowerCase());
    if (index !== -1) {
        const usuarioBorrado = usuarios.splice(index, 1);
        console.log(`Usuario borrado: ${usuarioBorrado[0].nombre}`);
    } else {
        console.log("No se encontr√≥ un usuario con ese nombre y email.");
    }
}
console.log("\nGesti√≥n de Usuarios:");
registrarUsuario("Ana P√©rez", "ana1993@example.com");
mostrarTodosLosUsuarios();  
buscarUsuario("Ana P√©rez");
borrarUsuario("Ana P√©rez", "ana1993@example.com");


/* ‚úÖPUNTO 4: Sistema de Pr√©stamos */

/* A) Desarrollar una funci√≥n prestarLibro(idLibro, idUsuario), dicha funcion debe marcar un libro como no disponible y agregarlo a la lista de de libros prestados. */ 

function prestarLibro(idLibro, idUsuario) {
    const libro = libros.find(libro => libro.id === idLibro);
    const usuario = usuarios.find(user => user.id === idUsuario);
    if (libro && usuario) {
        if (libro.disponible) {
            libro.disponible = false;
            usuario.librosPrestados.push(libro); /*üëâ Agrega el libro a la lista de libros prestados del usuario */
            console.log(`Libro prestado: ${libro.titulo} a ${usuario.nombre}`);
        } else {
            console.log(`El libro ${libro.titulo} no est√° disponible.`);
        }
    } else {        
        console.log("Libro o usuario no encontrado.");

    }
}


/* B) Desarrollar una funci√≥n devolverLibro(idLibro, idUsuario) que marque un libro como disponible y lo elimine de la lista de libros prestados del usuario. */

function devolverLibro(idLibro, idUsuario) {
    const libro = libros.find(libro => libro.id === idLibro);
    const usuario = usuarios.find(user => user.id === idUsuario);
    if (libro && usuario) {
        const index = usuario.librosPrestados.findIndex(libroPrestado => libroPrestado.id === idLibro);
        if (index !== -1) {
            libro.disponible = true;
            usuario.librosPrestados.splice(index, 1);
            console.log(`Libro devuelto: ${libro.titulo} por ${usuario.nombre}`);
        } else {
            console.log(`El libro ${libro.titulo} no est√° prestado a ${usuario.nombre}.`);
        }
    } else {
        console.log("Libro o usuario no encontrado.");
    }
}
console.log("\nSistema de Pr√©stamos:");
prestarLibro(1, 1);  /* Prestar "Colmillo Blanco" a "Monica Godoy" */
prestarLibro(2, 2);  /* Prestar "El Principito" a "Lucia Fernandez" */
devolverLibro(1, 1); /* Devolver "Colmillo Blanco" por "Monica Godoy" */


/* ‚úÖPUNTO 5: Sistema de Prestamos*/

/* A) Implementar una funci√≥n generarReporteLibros() que muestre un reporte con la cantidad total de libros, la cantidad de libros prestados, 
la cantidad de libros por g√©nero, el libro m√°s antiguo y el libro m√°s nuevo. */

function generarReporteLibros() {
    const totalLibros = libros.length;
    const librosPrestados = libros.filter(libro => !libro.disponible).length; /*üëâ Este metodo filtra los libros que no est√°n disponibles (prestados) y cuenta cu√°ntos hay. */
     const cantidadPorGenero = libros.reduce((acc, libro) => {  /*üëâ Se usa 'reduce' para contar la cantidad de libros por g√©nero, creando un objeto donde las claves son los g√©neros y los valores son las cantidades. */
        acc[libro.genero] = (acc[libro.genero] || 0) + 1;
        return acc;
    }, {});

    const libroMasAntiguo = libros.reduce((antiguo, libro) => (libro.a√±o < antiguo.a√±o ? libro : antiguo), libros[0]);
    const libroMasNuevo = libros.reduce((nuevo, libro) => (libro.a√±o > nuevo.a√±o ? libro : nuevo), libros[0]);

    const textoPorGenero = Object.entries(cantidadPorGenero) /*üëâ Transforma un objeto en un array de pares clave-valor, donde cada par es un array con el g√©nero y la cantidad de libros. */ 
        .map(([genero, cantidad]) => `${genero}: ${cantidad}`)
        .join(", ");

    console.log("Reporte de Libros:");
    console.log(`Cantidad total de libros: ${totalLibros}`);
    console.log(`Cantidad de libros prestados: ${librosPrestados}`);
    console.log(`Cantidad de libros por genero: ${textoPorGenero}`);
    console.log(`Libro m√°s antiguo: ${libroMasAntiguo.titulo} (${libroMasAntiguo.a√±o})`);
    console.log(`Libro m√°s nuevo: ${libroMasNuevo.titulo} (${libroMasNuevo.a√±o})`);
}

console.log("\nGeneraci√≥n de Reporte de Libros:");
generarReporteLibros();

/* ‚úÖPUNTO 6: Identificaci√≥n Avanzada de libros*/

/* A) Implementar una funci√≥n librosConPalabrasEnTitulo() que muestre los t√≠tulos de los libros que tienen 
m√°s de una palabra en el t√≠tulo, y que no contengan n√∫meros ni caracteres especiales. */

function librosConPalabrasEnTitulo() 
{
    const librosConPalabras = libros.filter(libro => { /*üëâ Filtra los libros que tienen m√°s de una palabra en el t√≠tulo, no contienen n√∫meros ni caracteres especiales */
        const palabras = libro.titulo.split(" ");
        return palabras.length > 1 && !/\d/.test(libro.titulo) && /^[a-zA-Z\s]+$/.test(libro.titulo); /* Verifica que el t√≠tulo no contenga n√∫meros ni caracteres especiales */ 
    }).map(libro => libro.titulo); /*üëâ Extrae solo los t√≠tulos v√°lidos */

    if (librosConPalabras.length > 0) {
        console.log(`Libros con m√°s de una palabra en el t√≠tulo:`);
        console.log(librosConPalabras.join(", "));
    } else {
        console.log("No se encontraron libros con m√°s de una palabra en el t√≠tulo.");
    }
}

 console.log("\nIdentificaci√≥n de Libros:");
librosConPalabrasEnTitulo();    


/* ‚úÖPUNTO 7: C√°lculos Estad√≠sticos */

/* A) Implementar una funci√≥n calcularEstadisticas() que calcule el promedio de a√±os de publicaci√≥n de cada libro, a√±o de publicacion 
mas frecuente, y la diferencia en a√±os entre el libro mas antiguo y el mas nuevo  */

function calcularEstadisticas() {
    const totalA√±os = libros.reduce((sum, libro) => sum + libro.a√±o, 0);
    const promedioA√±os = totalA√±os / libros.length;

    const a√±osFrecuentes = {};
    libros.forEach(libro => {
        a√±osFrecuentes[libro.a√±o] = (a√±osFrecuentes[libro.a√±o] || 0) + 1;
    });
    const a√±oMasFrecuente = Object.keys(a√±osFrecuentes).reduce((a√±o, actual) => a√±osFrecuentes[actual] > a√±osFrecuentes[a√±o] ? actual : a√±o); /*üëâ Extrae todas las claves (en este caso, los a√±os) del objeto `a√±osFrecuentes` y las devuelve como un array.*/

    const libroMasAntiguo = libros.reduce((antiguo, libro) => (libro.a√±o < antiguo.a√±o ? libro : antiguo), libros[0]);
    const libroMasNuevo = libros.reduce((nuevo, libro) => (libro.a√±o > nuevo.a√±o ? libro : nuevo), libros[0]);
    const diferenciaA√±os = libroMasNuevo.a√±o - libroMasAntiguo.a√±o;

    console.log("Estad√≠sticas de Libros:");
    console.log(`Promedio de a√±os de publicaci√≥n: ${promedioA√±os.toFixed(2)}`);
    console.log(`A√±o de publicaci√≥n m√°s frecuente: ${a√±oMasFrecuente}`);
    console.log(`Diferencia en a√±os entre el libro m√°s antiguo (${libroMasAntiguo.titulo}) y el m√°s nuevo (${libroMasNuevo.titulo}): ${diferenciaA√±os} a√±os`);
}
 console.log("\nC√°lculos Estad√≠sticos:");
calcularEstadisticas();


/* ‚úÖPUNTO 8: Manejo de Cadenas */

/* A) Implementar una funci√≥n normalizarDatos() que convierta todos los t√≠tulos de los libros a may√∫sculas, elimine espacios 
al inicio y final de los nombres de autores, formatee los emails de los usuarios a min√∫scula y muestre los t√≠tulos por consola  */

function normalizarDatos() {
    libros.forEach(libro => {
        libro.titulo = libro.titulo.toUpperCase();
    });
    console.log("T√≠tulos:");
    libros.forEach(libro => console.log(libro.titulo));
}
console.log("\nNormalizaci√≥n de Datos:");
normalizarDatos();

function eliminarEspaciosAutores() {
    libros.forEach(libro => {
        libro.autor = libro.autor.trim();
    });
    libros.forEach(libro => console.log(`${libro.titulo} - Autor: ${libro.autor}`));
}
console.log("\nAutores:");
eliminarEspaciosAutores();

function formatearEmailsUsuarios() {
    usuarios.forEach(usuario => {
        usuario.email = usuario.email.toLowerCase();
    });
    usuarios.forEach(usuario => console.log(`${usuario.nombre} - Email: ${usuario.email}`));
}
console.log("\nUsuarios:");
formatearEmailsUsuarios();


/* ‚úÖPUNTO 9: Interfaz de Usuario por Consola */

/* A) Implementar un men√∫ interactivo que permita al usuario seleccionar diferentes opciones para gestionar libros y usuarios. */

function menuPrincipal() { /*üëâ El men√∫ debe permitir agregar, buscar, ordenar y eliminar libros, registrar y buscar usuarios, as√≠ como generar reportes y realizar c√°lculos estad√≠sticos.*/
    let opcion;
    do {
        console.log("\n--- Men√∫ Principal ---");
        console.log("1. Agregar Libro");
        console.log("2. Buscar Libro");
        console.log("3. Ordenar Libros");
        console.log("4. Borrar Libro");
        console.log("5. Registrar Usuario");
        console.log("6. Mostrar Todos los Usuarios");
        console.log("7. Buscar Usuario");
        console.log("8. Borrar Usuario");
        console.log("9. Generar Reporte de Libros");
        console.log("10. Identificar Libros con Mas Palabras en el T√≠tulo");
        console.log("11. Calcular Las Estad√≠sticas de los Libros");
        console.log("12. Normalizar Datos de los Libros");
        console.log("13. Eliminar Espacios de Autores");
        console.log("14. Formatear Emails de Usuarios");
        console.log("0. Salir");

        opcion = prompt("Seleccione una opci√≥n: ");

        switch (opcion) {
            case '1':
                const id = parseInt(prompt("Ingrese ID del libro: "));
                const titulo = prompt("Ingrese t√≠tulo del libro: ");
                const autor = prompt("Ingrese autor del libro: ");
                const anio = parseInt(prompt("Ingrese a√±o de publicaci√≥n: "));
                const genero = prompt("Ingrese g√©nero del libro: ");
                agregarLibro(id, titulo, autor, anio, genero);
                break;
            case '2':
                const criterio = prompt("Ingrese criterio de b√∫squeda (titulo/autor): ");
                const valor = prompt(`Ingrese valor a buscar por ${criterio}: `);
                buscarLibro(criterio, valor);
                break;
            case '3':
                const ordenarCriterio = prompt("Ingrese criterio para ordenar (titulo/a√±o): ");
                ordenarLibros(ordenarCriterio);
                break;
            case '4':
                const borrarId = parseInt(prompt("Ingrese ID del libro a borrar: "));
                borrarLibro(borrarId);
                break;
            case '5':
                const nombreUsuario = prompt("Ingrese nombre del usuario: ");
                const emailUsuario = prompt("Ingrese email del usuario: ");
                registrarUsuario(nombreUsuario, emailUsuario);
                break;
            case '6':
                mostrarTodosLosUsuarios();
                break;
            case '7':
                const emailBuscar = prompt("Ingrese email del usuario a buscar: ");
                buscarUsuario(emailBuscar);
                break;  
            case '8':
                const nombreBorrar = prompt("Ingrese nombre del usuario a borrar: ");
                const emailBorrar = prompt("Ingrese email del usuario a borrar: ");
                borrarUsuario(nombreBorrar, emailBorrar);   
                break;
            case '9':   
                generarReporteLibros();
                break;  
            case '10':
                librosConPalabrasEnTitulo();
                break;
            case '11':
                calcularEstadisticas();
                break;
            case '12':
                normalizarDatos();
                break;
            case '13':
                eliminarEspaciosAutores();
                break;
            case '14':
                formatearEmailsUsuarios();
                break;
            case '0':
                console.log("Saliendo del sistema...");
                break;
            default:
                console.log("Opci√≥n no v√°lida. Por favor, intente de nuevo.");
        }
    } while (opcion !== '0');
}
console.log("\nBienvenido al Sistema de Gesti√≥n de Biblioteca");
menuPrincipal();    




